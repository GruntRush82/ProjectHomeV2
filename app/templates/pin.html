<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Felker Family Hub &mdash; PIN</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2.1.1">
</head>
<body>
    <div class="pin-page">
        <div class="login-brand">
            <h1>Felker Family Hub</h1>
        </div>

        <div class="pin-card">
            <h2>Enter PIN</h2>
            <p>Enter the 4-digit family PIN to continue</p>

            {% if lockout_remaining %}
            <div class="pin-lockout">
                Too many attempts. Try again in {{ lockout_remaining }} minutes.
            </div>
            {% else %}

            <!-- PIN dots -->
            <div class="pin-dots" id="pinDots">
                <div class="pin-dot" id="dot0"></div>
                <div class="pin-dot" id="dot1"></div>
                <div class="pin-dot" id="dot2"></div>
                <div class="pin-dot" id="dot3"></div>
            </div>

            <!-- Number pad -->
            <div class="pin-pad">
                <button class="pin-key" type="button" onclick="addDigit(1)">1</button>
                <button class="pin-key" type="button" onclick="addDigit(2)">2</button>
                <button class="pin-key" type="button" onclick="addDigit(3)">3</button>
                <button class="pin-key" type="button" onclick="addDigit(4)">4</button>
                <button class="pin-key" type="button" onclick="addDigit(5)">5</button>
                <button class="pin-key" type="button" onclick="addDigit(6)">6</button>
                <button class="pin-key" type="button" onclick="addDigit(7)">7</button>
                <button class="pin-key" type="button" onclick="addDigit(8)">8</button>
                <button class="pin-key" type="button" onclick="addDigit(9)">9</button>
                <div></div>
                <button class="pin-key" type="button" onclick="addDigit(0)">0</button>
                <button class="pin-key backspace" type="button" onclick="removeDigit()">&larr;</button>
            </div>

            <div class="pin-error" id="pinError">{{ error or "&nbsp;" }}</div>

            <form method="POST" action="/pin" id="pinForm" style="display:none;">
                <input type="hidden" name="pin" id="pinInput">
            </form>

            {% endif %}
        </div>
    </div>

    <script>
    var pin = '';

    function updateDots() {
        for (var i = 0; i < 4; i++) {
            var dot = document.getElementById('dot' + i);
            if (dot) dot.className = 'pin-dot' + (pin.length > i ? ' filled' : '');
        }
    }

    function addDigit(n) {
        if (pin.length >= 4) return;
        pin += String(n);
        updateDots();
        if (pin.length === 4) {
            document.getElementById('pinInput').value = pin;
            document.getElementById('pinForm').submit();
        }
    }

    function removeDigit() {
        pin = pin.slice(0, -1);
        updateDots();
    }
    </script>
</body>
</html>
